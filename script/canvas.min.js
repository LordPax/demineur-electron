const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),width=window.innerWidth-10,height=window.innerHeight-10,ratio=window.devicePixelRatio;canvas.width=width*ratio,canvas.height=height*ratio,canvas.style.width=width+"px",canvas.style.height=height+"px",ctx.scale(ratio,ratio);const lx=10,ly=10,t_case=40,mapx=width/2-200,mapy=height/2-200,superfor=(t,e,s=0,i=null)=>{const h=s<t?e(s,i):i;return s<t?superfor(t,e,s+1,h):h},rand=(t,e)=>Math.floor(Math.random()*(e-t+1)+t),aleaMine=t=>0===rand(0,t)?1:0,match=(t,e=null)=>({case:(s,i)=>match(t,s===t?i():e),default:t=>null===e?t():e}),vCase=[{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1}];class Case{constructor(t,e,s,i,h,a,g){this.nbMine=0,this.police=12,this.toggle=0,this.flag=0,this.img=new Image,this.setNbMine=(t=>{this.nbMine=t}),this.setMine=(t=>this.mine=t),this.drawCase=(()=>{this.drawRect("#000000","#EFEFEF");const t=0===this.getNbMine?" ":this.getNbMine;1===this.toggle?(this.drawRect("#000000",1!==this.getMine?"#FFFFFF":"#FF0000"),1!==this.getMine?this.drawText(t,this.getColorNbMine()):this.drawImages("images/mine.png")):1===this.flag&&this.drawImages("images/flag.png")}),this.toggleCase=(()=>{0===this.toggle&&(this.toggle=1)}),this.toggleFlag=(()=>{0===this.flag?this.flag=1:this.flag=0}),this.drawRect=((t,e)=>{this.ctx.strokeStyle=t,this.ctx.fillStyle=e,this.ctx.strokeRect(this.getX,this.getY,this.t,this.t),this.ctx.fillRect(this.getX,this.getY,this.t,this.t)}),this.drawText=((t,e="#000000")=>{const s=`${t}`,i=this.getX+this.t/2-s.length*this.police/3,h=this.getY+this.t/2+this.police/3;this.ctx.font=`${this.police}px sans-serif`,this.ctx.fillStyle=e,this.ctx.fillText(t,i,h)}),this.drawImages=(t=>{this.img.src=t,this.ctx.drawImage(this.img,this.getX+5,this.getY+5,this.getT-10,this.getT-10)}),this.getColorNbMine=(()=>match(this.getNbMine).case(1,()=>"#0000FF").case(2,()=>"#298A08").case(3,()=>"#FF0000").case(4,()=>"#00FFFF").case(5,()=>"#FF00FF").case(6,()=>"#FFFF00").case(7,()=>"#FF8000").case(8,()=>"#08298A").case(9,()=>"#FF0000").default(()=>"#000000")),this.ctx=t,this.nbx=i,this.nby=h,this.mapx=e,this.mapy=s,this.t=a,this.mine=g}get getNbX(){return this.nbx}get getNbY(){return this.nby}get getX(){return this.mapx+this.t*this.nbx}get getY(){return this.mapy+this.t*this.nby}get getT(){return this.t}get getMine(){return this.mine}get getToggle(){return this.toggle}get getNbMine(){return this.nbMine}get getFlag(){return this.flag}}class MapDem{constructor(t,e,s,i,h,a){this.cases=[],this.getCase=((t,e)=>this.cases[e*this.lx+t]),this.initMine=(()=>{this.cases.forEach(t=>t.setMine(aleaMine(3)))}),this.initMap=(()=>{this.cases=superfor(this.lx,(t,e)=>superfor(this.ly,(e,s)=>[...s,new Case(this.ctx,this.x,this.y,e,t,this.t_case,0)],0,e),0,[]),this.initMine()}),this.drawMap=(()=>{this.cases.forEach(t=>t.drawCase())}),this.evaluerCase=(t=>{0===t.getMine&&(t.setNbMine(this.chercheMine(t)),0===t.getNbMine&&this.etandCase(t))}),this.chercheMine=((t,e=0,s=0)=>{const{x:i,y:h}=this.chercheCoord(t,s),a=1===this.getCase(i,h).getMine?e+1:e;return s<7?this.chercheMine(t,a,s+1):a}),this.etandCase=((t,e=0)=>{const{x:s,y:i}=this.chercheCoord(t,e),h=this.getCase(s,i);return h.setNbMine(this.chercheMine(h)),h.toggleCase(),e<7?this.etandCase(t,e+1):0}),this.chercheCoord=((t,e)=>{const s=t.getNbX+vCase[e].x,i=t.getNbY+vCase[e].y,h=s>=0&&s<this.getLx&&i>=0&&i<this.getLy;return{x:h?s:t.getNbX,y:h?i:t.getNbY}}),this.propagueCase=(t=>{}),this.x=e,this.y=s,this.lx=i,this.ly=h,this.ctx=t,this.t_case=a}get getX(){return this.x}get getY(){return this.y}get getLx(){return this.lx}get getLy(){return this.ly}get gCases(){return this.cases}}class Partie{constructor(){this.pts=0,this.map=null,this.etat=0,this.setMap=((t,e,s,i,h,a)=>{this.map=new MapDem(t,e,s,h,h,a)}),this.event=(t=>{t.addEventListener("click",e=>{this.map.gCases.forEach(s=>this.eventCase(t,e,s))})}),this.eventCase=((t,e,s)=>{const i=e.clientX,h=e.clientY;i>s.getX&&i<s.getX+s.getT&&h>s.getY&&h<s.getY+s.getT&&(!1===e.ctrlKey&&0===s.getFlag?(this.map.evaluerCase(s),s.toggleCase()):!0===e.ctrlKey&&s.toggleFlag())}),this.gagner=(()=>{}),this.perdue=(()=>{alert("perdue"),this.map.initMap(),this.etat=0}),this.analyse=(()=>{this.map.gCases.forEach(t=>this.toggleAll(t)),-1===this.etat&&this.perdue()}),this.toggleAll=(t=>{1===t.getMine&&1===t.getToggle&&(this.map.gCases.filter(t=>1===t.getMine&&0===t.getFlag).forEach(t=>t.toggleCase()),this.etat=-1)})}get getPts(){return this.pts}get getMap(){return this.map}}const part=new Partie;part.setMap(ctx,mapx,mapy,10,10,40);const map=part.getMap;map.initMap(),part.event(canvas);const draw=()=>{ctx.clearRect(0,0,width,height),map.drawMap()},update=()=>{part.analyse()},main=()=>{ctx.clearRect(0,0,width,height),map.drawMap(),part.analyse(),requestAnimationFrame(main)};main();